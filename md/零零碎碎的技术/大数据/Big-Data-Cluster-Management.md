<!--
title: 大数据日知录 - 集群资源管理与调度
date: 2016-12-28 20:18:46
tags:
- Big Data
- Resource Management
-->
### 大数据日知录 - 集群资源管理与调度
Date: 2016-12-28 20:18:46
## 资源管理调度概念模型
资源管理概念模型三要素：
- 资源组织模型，将集群中的资源按一定方式组织起来方便分配。常见的资源管理方式是将资源组织成多级队列的方式。
- 调度策略，负责以一定方式将资源分配给任务，常见的包括FIFO, 公平调度，能力调度，延迟调度等。
- 任务组织模型，强多用户提交的多任务通过一定方式组织起来，方便资源分配


<!-- more -->
![image](http://www.2cto.com/uploadfile/Collfiles/20160829/2016082909250646.png)

## 通用架构
![image](http://www.2cto.com/uploadfile/Collfiles/20160829/2016082909250647.png)

## 调度系统设计问题
- 资源异质性与工作负载异质性
- 数据局部性：节点局部性，机架局部性，全局局部性，尽量保证节点局部性
- 抢占式调度与非抢占式调度，是否只是从空闲资源分配
- 资源分配力度：作业级，任务级(作业细分为多个DAG任务）。全部分配，增量分配，储备分配
- 避免饿死与死锁
- 资源隔离，如容器

## 资源管理与调度系统泛型
- 集中式调度器，全局中央掉多。适合小型集群，扩展性和灵活性差
- 两级调度器：中央调度器和框架调度器。如Mesos, YARN.中央调度器实行粗粒度调度，各个框架进行细粒度调度。适合大规模同质集群应用。
- 状态共享调度器，中央控制器功能弱化成了集群资源状态信息。所有计算框架可以看到全局资源状态并相互竞争去获取所需资源。易导致冲突，采用乐观并发控制搜段。适合负载异质较强且冲突不多的集群应用。

## 资源调度策略
- FIFO
- 公平调度。用户任务分配到多个资源池，每个资源池设置最高和最低限。在保证最低的情况下根据优先级与公平策略来分配资源
- 能力调度。与公平调度相比，更强调用户间的公平性。将用户和任务组织成队列，设定资源的最高与最低限。队列内部按照优先级FIFO.
- 延迟调度策略。其他调度策略的辅助措施，增加数据局部性。可掉过若干次分配来尝试获取数据局部性。
- 主资源公平调度策略（DRF), 最低啊最小公平算法的一个体现：最大化目前分配到最少资源量的用户或者任务的资源量。不同用户的主资源不一样，如I/O或者CPU或者内存。保证各个用户或者任务的主资源尽量公平。
- 。。。。。。

## Mesos
二级调度器。只是根据一定策略(公平调度策略和优先级调度策略)将资源分配给各个框架。具体的资源调度策略下推到各个框架，减少中央调度器负载。

Mesos采用典型的主从结构，并且中央服务器有备份，通过zookeeper保证failure recovery.
![image](http://mesos.apache.org/assets/img/documentation/architecture3.jpg)

每个计算框架向Mesos提供两个接口，Scheduler和Executor. Scheduler根据Mesos master给的资源决定分配给各个task的具体资源量，Mesos Master把Executor分配到提供资源的Mesos Slave上。

比较适合不同框架任务同质化的场景，特别是短作业。

## YARN
Yet Another Resource Negotiator. 

将资源管理和任务生命周期管理分离。资源管理由resource manager (RM)负责，提供公平或者能力调度策略。每个任务有一个应用服务器(AM)来完成所需的资源的申请和任务生命周期管理。RM类似主控服务器，AM类似二级服务器。每个机器还有一个节点服务器。
![image](http://bigdataanalyticsnews.com/wp-content/uploads/2014/09/Yarn-Architecture.png)

RM申请资源，准备好后通过AM Service启动AM后，剩下的工作就交给AM了, 包括任务间的资源分配和生命周期管理。











