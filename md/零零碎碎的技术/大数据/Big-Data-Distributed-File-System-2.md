<!--
title: 大数据日知录 - 分布式文件系统 - 2
date: 2017-01-13 14:07:07
tags:
- Big Data
-->
## HeyStack
Blob数据存储系统，一次写入，多次读取，从不更改，很少删除。主要目标是保证读取效率。

通过CDN来存储热门请求。

一次读取元数据（内存中），一次读取实际数据。多个数据（如图片）存储在一个文件中。每个物理卷100G, 不同机器的多个物理卷组成一个逻辑卷 （多备份）。存储以逻辑卷为单位。
<!-- more -->
![image](https://2.bp.blogspot.com/_3QpHuJ3JYaA/TQrsnOO9-7I/AAAAAAAAA2I/yYp7XTJsuz4/s400/fig2.png)

HayStack目录服务 （图片到存储的信息），HeyStack缓存系统，HeyStack存储系统。http://<CDN>/<cache>/<机器ID>/<逻辑卷ID, 图片ID>. 查找时，先找CDN，如果没有找到，把CDN部分从URL去掉。

HeyStack目录服务通过数据库实现。

HeyStack存储机存储了物理卷文件及其对应的索引文件，每个物理卷有一个内存映射表映射图片ID到存储信息(位置，删除标记位等)。删除图片时，不删除数据，直接更新删除标记位。

## 文件存储布局
- 行式存储
- 列式存储
- 混合存储

列式存储与混合存储在数据分析系统中应用较广。

### 行式存储
每个记录字段连续在一起，不利于查询；对所有字段只能使用一种压缩方法，磁盘利用率低。但便于按行读取整个数据。

### 列式存储
同一列内容连续存放。记录数据可能是简单(flat)或者复杂(nested). 

flat一般采用列族存储。如果要处理多个字段就需要拼接数据。可以将多个经常联合使用的数据拼接在一起。BigTable和HBase使用列族存储。

Google的Dremel列式存储支持嵌套数据。除了数据项之外，还需要存储重复层和定义层信息，用于恢复数据。它的好处是能够根据列式存储快速回复数据。

### 混合式存储
将记录表按行分组，组内部按列连续存储。

每个行数据块记录一些元数据及索引信息，如记录个数，压缩方法，地址分布，列值的统计信息等。

RCFile, ORCFile, Parquet.

## 纠删码
在保证数据完整性的情况下减少数据存储成本。通过对原始数据的进行校验并保留校验数据，增加冗余来保证数据的可恢复性。

通常对于热数据仍然保持多个备份，对冷数据采用1个备份+纠删码。类似某些Raid类型。
MDS是常用的纠删码(典型的如Reed-Solomon编码)。非MDS的有LRC. 
